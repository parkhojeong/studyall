* transaction isolation level
- db trade off: data correctness vs concurrency/performance
- db provide isolation level to control trade off

* concurrency problems
1. dirty read
  - definition: a transaction read uncommitted data that another transaction is writing
  - ex. tx A write product price from 100 to 200, but is not committed yet. this time tx B read product price 200(dirty read)
2. non-repeatable read
  - definition: in one transaction, read the same data twice, but get a different result because another transaction has updated the data and committed 
  - ex. 
    - tx A read product price 100
    - after, tx B update product price to 200 and commit
    - tx A read product price 200(non-repeatable read)
3. phantom read 
  - definition: in one transaction, read the same range of data twice, but get new data because another transaction has inserted new data into the range
  - ex.
    - tx A read count of product by category '전자기기' and result is 5
    - tx B insert a new product by category '전자기기' and commit
    - tx A read count of product by category '전자기기' and result is 6(phantom read) 

* standard isolation level
```
+------------------+------------+---------------------+--------------+
| isolation level  | Dirty Read | Non-Repeatable Read | Phantom Read |
+------------------+------------+---------------------+--------------+
| READ UNCOMMITTED |    O       |         O           |     O        |
+------------------+------------+---------------------+--------------+
| READ COMMITTED   |    X       |         O           |     O        |
+------------------+------------+---------------------+--------------+
| REPEATABLE READ  |    X       |         X           | O(partial X*)|
+------------------+------------+---------------------+--------------+
| SERIALIZABLE     |    X       |         X           |     X        |
+------------------+------------+---------------------+--------------+
```
- READ UNCOMMITTED
- READ COMMITTED: Oracle, SQL Server default
- REPEATABLE READ: MySQL innoDB default
- SERIALIZABLE: 

* advanced - MySQL innoDB characteristics
- innoDB mostly prevents phantom read by using mvcc and gap lock in REPEATABLE READ 

* isolation level check and change
- can change isolation level to transaction level, session level, db system level 
```sql
SELECT @@transaction_isolation;
SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED; -- only for current session
```

- global change(caution!)
```sql
SET GLOBAL TRANSACTION ISOLATION LEVEL READ COMMITTED;
```
- SET GLOBAL is a temporary change, if restart mysql, the change is reset
- permanent setting: change my.cnf or my.ini

* practical tip: what isolation level to use?
- conclusion: recommend mysql default
- read uncommitted
  - realtime aggregation or statistics work  for large size data. dirty read is not a problem in this case.
- read committed: when non-repeatable read is not a problem. normally expect 10~30% improvement in performance. 
- serializable: in practice, serializable is rarely not used
  - use instead pessimistic lock(ex. select .. for update) or optimistic lock(version number).