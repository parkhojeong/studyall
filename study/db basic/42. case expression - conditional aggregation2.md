* case expression - conditional aggregation2

- requirement: report creation by sql, seems like excel's pivot table
  +--------------+-----------------+---------------+---------------+
  | total_orders | completed_count | shipped_count | pending_count |
  +--------------+-----------------+---------------+---------------+
  |            7 |               4 |             2 |             1 |
  +--------------+-----------------+---------------+---------------+

* aggregate function with case

- pattern1: COUNT(CASE ..)
```
COUNT(CASE 
  WHEN status = 'COMPLETED' THEN 1 END
)
```
- status 'COMPLETED' return 1
- else return null
- count row with status 'COMPLETED'

- pattern2: SUM(CASE ..)
```
(CASE WHEN status = 'COMPLETED' THEN 1 ELSE 0 END)
```
- status 'COMPLETED' return 1
- else return 0

* report using case and aggregate function
```sql
select 
	count(*) as total_count,
	sum(case when status='COMPLETED' THEN 1 ELSE 0 END) as completed_count,
    sum(case when status='SHIPPED' THEN 1 ELSE 0 END) as shipped_count,
    sum(case when status='PENDING' THEN 1 ELSE 0 END) as pending_count
from orders;
```
* logical execution flow
1. read orders table(only once)
2. repeat each row
   2.1 single row evaluation
   2.2 select clause evaluation
   2.3 case expression evaluation

* practice 2: group by with case
- requirement: group by category, count orders by status
```sql
select p.category,
	count(*) as total_count,
	sum(case when status = 'COMPLETED' THEN 1 ELSE 0 END) as completed_count,
    sum(case when status = 'SHIPPED' THEN 1 ELSE 0 END) as shipped_count,
    sum(case when status = 'PENDING' THEN 1 ELSE 0 END) as pending_count
from orders o
join products p on o.product_id = p.product_id
group by p.category
```


* conditional aggregation using case, tool that restructure and analyze data 