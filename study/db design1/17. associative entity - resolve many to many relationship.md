* associative entity -  resolve many-to-many relationship


# problem1: m:n relationship problem(order - product)
1. we can't implement m:n relationship physically
rdbms represent relationships as a foreign key, and use 2 demensional table
suppose, user(user_id=1) order(order_id=1001) product1(product_id=101) and product2(product_id=102)

trial1: add product_id column to order table(1:n approach) 
```
+----------------+-----------------+---------------------+------------------+
| Order ID (PK)  | Member ID (FK)  |  Order Date/Time    | Product ID (FK)  |
+----------------+-----------------+---------------------+------------------+
|      1001      |        1        |     2025-08-06      |       101        |
+----------------+-----------------+---------------------+------------------+
|      ????      |        1        |     2025-08-06      |       102        |
+----------------+-----------------+---------------------+------------------+
```
- problem
  - for product_id = 101, 102, we have to create 2 rows in order table.
  - but we can't create 2 rows by order_id = 1001 because pk can't be duplicated.

trial2: add multiple columns
```
+----------------+----------------+---------------------+----------------+----------------+----------------+----+
| Order ID (PK)  | Member ID (FK) |  Order Date/Time    | product1_id(FK) | product2_id(FK)| product3_id(FK)| ...| 
+----------------+----------------+---------------------+----------------+----------------+----------------+----+
|      1001      |        1       |     2025-08-06      |       101      |       102      |      NULL      | ...|
+----------------+----------------+---------------------+----------------+----------------+----------------+----|
```
- problem
  - scalability issue: for number of products to be ordered, n number of columns must be added.
  - space wasted: not used columns must be filled with NULL.
  - hard to search: for order including product_id =102, we must use condition like product1_id = 102, where product2_id = 102 or product_3_id = 102, ...

trial3: 
create product_ids column, and store product_ids as a string. 
```
+----------------+----------------+---------------------+-----------------------+
| Order ID (PK)  | Member ID (FK) |  Order Date/Time    |      Product IDs      |
+----------------+----------------+---------------------+-----------------------+
|      1001      |        1       |     2025-08-06      |       "101, 102"      |
+----------------+----------------+---------------------+-----------------------+
```
problem
  - hard to search: for order including product_id =102, product_ids like "%102%" must be used.
  - complexity of update or delete: in order_id = 1003, how to delete product_id = 103?
  - atomicity violation: first normal form violation.

# problem2: space is not exist for relationship data
space does not exist for snapshot data when the order is created

at time of order creation, product data snapshot should be stored anywhere(product price, discount price, order quantity)

trial1: store in order table
```
+----------------+----------------+----------+------------------+-----------------------+
| Order ID (PK)  | Member ID (FK) |   ...    | Order Quantity   | Order Price (Total)   |
+----------------+----------------+----------+------------------+-----------------------+
|      1001      |        1       |   ...    |        3         |          ???          |
+----------------+----------------+----------+------------------+-----------------------+
```
problem
  - what is order price? product 1 price or product 2 price?
  - if the total price is stored, we can't know each product price information

trial2: store in product table
the product table is for current product information, not for previous product product information.
it is not suitable to add order count or order price in product table.  

# solution: make entity for relationship
introduce associative entity.
create order_item entity for relationship between order and product.
  - m:n relationship is resolved by two 1:n relationships. solve problem1
  - store relationship data in associative entity. solve problem2

```
[ Order ]                       [ Order Item ]                  [ Product ]
+-----------------------+       +-----------------------+      +-----------------------+
| Order Number (PK)     |       | Item Number (PK)      |      | Product Code (PK)     |
| Order Date/Time       |       | Order Number (FK)     |      | Product Name          |
| Order Status          | ||--|<| Product Code (FK)     |>O--||| Product Price         |
| Shipping Address      |       | Unit Price            |      | Stock Quantity        |
| Total Payment Amount  |       | Quantity              |      | Registration Date     |
+-----------------------+       +-----------------------+      +-----------------------+
```
- order - order item (1:n)
  - one order has one or more order items.
  - order item belongs to one order
- order item - product (n:1)
  - one order item has one product
  - product can be ordered many times or not ordered at all.
```
+-------------------+----------------+-----------------+--------------+----------------+
| Order Item ID(PK) | Order ID (FK)  | Product ID (FK) |  Unit Price  |    Quantity    |
+-------------------+----------------+-----------------+--------------+----------------+
|        201        |      1001      |       101       |    120,000   |       2        |
+-------------------+----------------+-----------------+--------------+----------------+
|        202        |      1001      |       102       |     45,000   |       1        |
+-------------------+----------------+-----------------+--------------+----------------+
```

* practical tip - m:n relationship must be resolved, find the necessary attribute
if you find m:n relationship in conceptual modeling
1. almost 100% it is resolved by associative entity.
2. m:n relationship has additional attribute itself.
  - when an user order, we need a discount rate applied to each product
  - when an user order, we need almost time ordered
- conclusion: if use find m:n relationship
  - beyond you think that "here, associative entity is needed"
  - find "what is data that has meaning when this relationship is created"