* monthly sales statistic report
- requirement: monthly total order count and total sales amount

- without denormalization
```sql
select 
	DATE_FORMAT(o.ordered_at, '%Y%m') as `year_month`,
	count(distinct o.order_id),
	sum(oi.order_quantity * oi.order_price)
from orders o
    join order_item oi on o.order_id = oi.order_id
where o.order_status NOT IN ('CANCELED')
group by `year_month`
order by `year_month`;
```
-with denormalization
```sql
select
  DATE_FORMAT(ordered_at, '%Y%m') as `year_month`,
  count(order_id),
  sum(total_amount)
from orders 
where order_status NOT IN ('CANCELED')
group by `year_month`
order by `year_month`;
```


* marketing - best seller product top5
- requirement: 2025-08~2025-09, most sold products, order by sales amount desc, top 5

- without denormalization
```sql
select 
    p.product_name, 
    sum(oi.order_quantity) as total_quantity_sold, 
    sum(oi.order_price * oi.order_quantity) as total_sales_amount
from product p
    join order_item oi on p.product_id = oi.product_id
    join orders o on oi.order_id = o.order_id
where o.order_status NOT IN ('CANCELED')
    and DATE_FORMAT(o.ordered_at, '%Y%m') between '202508' and '202509'
group by p.product_id
order by total_quantity_sold desc, total_sales_amount desc
limit 5;
```

-with denormalization
```sql
select 
    oi.product_name, 
    sum(oi.order_quantity) as total_quantity_sold, 
    sum(oi.order_price * oi.order_quantity) as total_sales_amount
from order_item oi 
    join orders o on oi.order_id = o.order_id
where o.order_status NOT IN ('CANCELED')
    and DATE_FORMAT(o.ordered_at, '%Y%m') between '202508' and '202509'
group by oi.product_name
order by total_quantity_sold desc, total_sales_amount desc
limit 5;
```

* vip customer top2
- requirement: find a user who has a high total order amount, top 2

- without denormalization
```sql
select 
    m.member_id, 
    m.member_name,
    sum(oi.order_price * oi.order_quantity) as total_purchase_amount,
    count(distinct o.order_id) as total_order_count
from member m
    join orders o on m.member_id = o.member_id
    join order_item oi on o.order_id = oi.order_id
where o.order_status NOT IN ('CANCELED')
group by m.member_id
order by total_purchase_amount desc
limit 2;
```

- with denormalization
```sql
select
  m.member_id,
  m.member_name,
  sum(o.total_amount) as total_purchase_amount,
  count(o.order_id) as total_order_count
from member m
    join orders o on m.member_id = o.member_id
where o.order_status NOT IN ('CANCELED')
group by m.member_id
order by total_purchase_amount desc
limit 2;
```