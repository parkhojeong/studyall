* table definition
- use default column
- use null column

in this definition
- notes include default
- constraint column include null constraint
  - if empty, not null
- auto_increment default is omitted
- created_at, updated_at default is omitted
- unique -> UQ
- automation time record 
  - created_at: row insert time
  - updated_at: row update time
- table_id: identifier(surrogate key)

# member
- table name: member
- table description: basic information of user that joins the shopping mall

| No. | column name | data type    | constraint | notes                                             |
|-----|-------------|--------------|------------|---------------------------------------------------|
| 1   | member_id   | big int      | PK         |                                                   |
| 2   | login_id    | varchar(50)  | UQ         | login_id used for user login                      |
| 3   | password    | varchar(255) |            | password(must encrypted)                          |
| 4   | member_name | varchar(50)  |            | member name                                       |
| 5   | email       | varchar(100) | UQ         | email for member authentication and communication |
| 6   | addr        | varchar(255) | NULL       | address for product delivery                      |

# product
- table name: product
- table description: product information that shopping mall sells

| No. | column name    | data type    | constraint | notes                                         |
|-----|----------------|--------------|------------|-----------------------------------------------|
| 1   | product_id     | big int      | PK         |                                               |
| 2   | product_name   | varchar(100) | UQ         | product name                                  |
| 3   | price          | int          |            | current sale price of product                 |
| 4   | stock_quantity | int          |            | current stock quantity of product. default: 0 |

- index 

| index name       | column       | notes                                     |
|------------------|--------------|-------------------------------------------|
| idx_product_name | product_name | index for product name query performance  |

# orders
- table name: orders
- table description: order information of user

| No. | column_name  | data type   | constraint | notes                                                                |
|-----|--------------|-------------|------------|----------------------------------------------------------------------|
| 1   | order_id     | BIGINT      | PK         |                                                                      |
| 2   | member_id    | BIGINT      | FK         | user ordering(member.member_id)                                      |
| 3   | ordered_at   | DATETIME    |            | business time that user order, transmission from backend application |
| 4   | order_status | VARCHAR(20) |            | ORDERED(default), CANCELED                                           |
| 5   | total_amount | INT         |            | [denormalization] sum of order product amount                        |

| index name                  | column                   | notes     |
|-----------------------------|--------------------------|-----------|
| idx_order_status_ordered_at | order_status, ordered_at | for admin |

# order_item
- table description: detail information of each product in order

| No. | column name    | data type   | constraint | notes                                                |
|-----|----------------|-------------|------------|------------------------------------------------------|
| 1   | order_item_id  | BIGINT      | PK         |                                                      |
| 2   | order_id       | BIGINT      | FK         | this product is included in(orders.order_id)         |
| 3   | product_id     | BIGINT      | FK         | ordered product(product.product_id)                  |
| 4   | order_price    | INT         |            | each product price at ordering(snapshot)             |
| 5   | order_quantity | INT         |            | product quantity ordered                             |
| 6   | product_name   | VARCHAR(10) |            | [denormalization] product name at ordering(sanpshot) |

# delivery
- table description: delivery information of order(1:1 relationship to orders)


| No. | column name     | data type    | constraint | notes                                                |
|-----|-----------------|--------------|------------|------------------------------------------------------|
| 1   | delivery_id     | BIGINT       | PK         |                                                      |
| 2   | order_id        | BIGINT       | FK, UQ     | order to delivery(orders.order_id)                   |
| 3   | delivery_status | VARCHAR(20)  |            | READY(default), SHIPPING, COMPLETED                  |
| 4   | traking_no      | VARCHAR(50)  | NULL       | number that courier issue when delivery start        |
| 5   | ship_addr       | VARCHAR(255) |            | address to delivery product                          |

# pay
- table description: payment information of order(1:1 relationship to orders)


| No. | column name | data type   | constraint | notes                                                                               |
|-----|-------------|-------------|------------|-------------------------------------------------------------------------------------|
| 1   | pay_id      | BIGINT      | PK         |                                                                                     |
| 2   | order_id    | BIGINT      | FK, UQ     | order to pay(orders.order_id)                                                       |
| 3   | pay_method  | VARCHAR(50) |            | CREDIT_CARD, BANK_TRANSFER                                                          |
| 4   | pay_amount  | INT         |            | paid amount by bank, card                                                           |
| 5   | pay_status  | VARCHAR(20) |            | PAID, FAILED, CANCELED                                                              |
| 6   | paid_at     | DATETIME    | NULL       | time when payment is completed. in business view, paid time by bank, credit company |

* created_at, updated_at
- almost standard columns
- created_at: not changed
- updated_at: changed when row updated

* practice tips
- use also created_by, updated_by
- spring data jpa provide automation

# why is ordered_at used? (ordered_at vs created_at)
created_at is system time. ordered_at is business time.
system time vs business time
- system time(created_at): when row inserted
- business time(ordered_at): when an order is made, a user presses the order button

* when are two times different?
scenario1: system error, latency
most common case that server overloaded or db server overloaded
1. user a order at '2000-01-01 14:59:59'(business event occurred)
2. backend server receive request, and ordered_at is set to '2000-01-01 14:59:59'
3. backend server try to insert row into db
4. but db server is overloaded, so insert is delayed in 2 seconds
5. insert is completed at '2000-01-01 15:01:01'(system time)
-> ordered_at is '14:59:59', created_at is '15:00:01'
suppose that in business, today delivery is only before 3pm
if created_at in only used, this order is considered as after pm3

scenario2: data migration
suppose that existing data is migrated to new db server
1. 2024-12-25 order data is migrated to new db server
2. ordered_at is maintained as it is
3. created_at is changed to time when data is migrated

conclusion: use system time and business time separately
- created_at is for system technical integrity
- ordered_at is for business clarity
  - paid_at is used when payment issue occurs