* join strategy: using parent and child.

table design
product table
- product_id(pk), product_type
- name, price, stock_quantity

book
- product_id(pk, fk)
- author, isbn
electronics
- product_id(pk, fk)
- manufacturer, warranty
clothing
- product_id(pk, fk)
- color, size

table creation
```sql
-- 기존 테이블 정리
DROP TABLE IF EXISTS orders;
DROP TABLE IF EXISTS book;
DROP TABLE IF EXISTS electronics;
DROP TABLE IF EXISTS clothing;
DROP TABLE IF EXISTS product;

-- 부모 테이블: 공통 속성을 가진다
CREATE TABLE product (
  product_id BIGINT PRIMARY KEY AUTO_INCREMENT,
  product_type VARCHAR(20) NOT NULL, -- 구분자 컬럼
  name VARCHAR(200) NOT NULL,
  price INT NOT NULL,
  stock_quantity INT NOT NULL DEFAULT 0,
  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_product_type (product_type)
);

-- 자식 테이블: 도서
CREATE TABLE book (
  product_id BIGINT PRIMARY KEY,
  author VARCHAR(100) NOT NULL,
  isbn VARCHAR(13),
  publisher VARCHAR(100),
  FOREIGN KEY (product_id) REFERENCES product(product_id)
);

-- 자식 테이블: 전자제품
CREATE TABLE electronics (
  product_id BIGINT PRIMARY KEY,
  manufacturer VARCHAR(100) NOT NULL,
  warranty_months INT NOT NULL DEFAULT 12,
  power_consumption INT,
  FOREIGN KEY (product_id) REFERENCES product(product_id)
);

-- 자식 테이블: 의류
CREATE TABLE clothing (
  product_id BIGINT PRIMARY KEY,
  size VARCHAR(10) NOT NULL,
  color VARCHAR(50) NOT NULL,
  material VARCHAR(100),
  FOREIGN KEY (product_id) REFERENCES product(product_id)
);
```

insert data
```sql
-- 도서 데이터 입력
INSERT INTO product (product_type, name, price, stock_quantity)
VALUES ('BOOK', '클린 코드', 33000, 100);
INSERT INTO book (product_id, author, isbn, publisher)
VALUES (LAST_INSERT_ID(), '로버트 마틴', '9788966260959', '인사이트');

INSERT INTO product (product_type, name, price, stock_quantity)
VALUES ('BOOK', '이펙티브 자바', 36000, 50);
INSERT INTO book (product_id, author, isbn, publisher)
VALUES (LAST_INSERT_ID(), '조슈아 블로크', '9788966262281', '인사이트');

INSERT INTO product (product_type, name, price, stock_quantity)
VALUES ('BOOK', 'JPA 프로그래밍', 43000, 30);
INSERT INTO book (product_id, author, isbn, publisher)
VALUES (LAST_INSERT_ID(), '김영한', '9788960777330', '에이콘');

-- 전자제품 데이터 입력
INSERT INTO product (product_type, name, price, stock_quantity)
VALUES ('ELECTRONICS', '갤럭시', 1800000, 200);
INSERT INTO electronics (product_id, manufacturer, warranty_months, power_consumption)
VALUES (LAST_INSERT_ID(), '삼성전자', 24, 15);

INSERT INTO product (product_type, name, price, stock_quantity)
VALUES ('ELECTRONICS', '맥북 프로 14', 2500000, 50);
INSERT INTO electronics (product_id, manufacturer, warranty_months, power_consumption)
VALUES (LAST_INSERT_ID(), '애플', 12, 96);

INSERT INTO product (product_type, name, price, stock_quantity)
VALUES ('ELECTRONICS', 'LG 그램 17', 1800000, 80);
INSERT INTO electronics (product_id, manufacturer, warranty_months, power_consumption)
VALUES (LAST_INSERT_ID(), 'LG전자', 24, 65);

-- 의류 데이터 입력
INSERT INTO product (product_type, name, price, stock_quantity)
VALUES ('CLOTHING', '오버핏 맨투맨', 35000, 500);
INSERT INTO clothing (product_id, size, color, material)
VALUES (LAST_INSERT_ID(), 'L', '블랙', '면 100%');

INSERT INTO product (product_type, name, price, stock_quantity)
VALUES ('CLOTHING', '슬림핏 청바지', 59000, 300);
INSERT INTO clothing (product_id, size, color, material)
VALUES (LAST_INSERT_ID(), 'M', '인디고', '데님');

INSERT INTO product (product_type, name, price, stock_quantity)
VALUES ('CLOTHING', '패딩 점퍼', 189000, 100);
INSERT INTO clothing (product_id, size, color, material)
VALUES (LAST_INSERT_ID(), 'XL', '네이비', '폴리에스터');
```

all products query
```sql
SELECT product_id, product_type, name, price, stock_quantity
FROM product
ORDER BY product_id DESC;
```

product query by type
```sql
-- 도서 상세 조회
SELECT p.product_id, p.name, p.price, p.stock_quantity,
   b.author, b.isbn, b.publisher
FROM product p
JOIN book b ON p.product_id = b.product_id;

-- 전자제품 상세 조회
SELECT p.product_id, p.name, p.price, p.stock_quantity,
       e.manufacturer, e.warranty_months, e.power_consumption
FROM product p
         JOIN electronics e ON p.product_id = e.product_id;
```

product id query
```sql
-- 상품 ID가 2인 상품 조회 (도서인 경우)
SELECT p.product_id, p.product_type, p.name, p.price,
   b.author, b.isbn, b.publisher
FROM product p
LEFT JOIN book b ON p.product_id = b.product_id
WHERE p.product_id = 2;
```

if a child type is unknown, left join is used.
```sql
SELECT
  p.product_id, p.product_type, p.name, p.price,
  b.author, b.isbn, b.publisher,
  e.manufacturer, e.warranty_months,
  c.size, c.color
FROM product p
LEFT JOIN book b ON p.product_id = b.product_id
LEFT JOIN electronics e ON p.product_id = e.product_id
LEFT JOIN clothing c ON p.product_id = c.product_id
WHERE p.product_id = 5;
```
+----------+------------+--------+-------+------+----+---------+------------+---------------+----+-----+
|product_id|product_type|name    |price  |author|isbn|publisher|manufacturer|warranty_months|size|color|
+----------+------------+--------+-------+------+----+---------+------------+---------------+----+-----+
|5         |ELECTRONICS |맥북 프..|2500000|null  |null|null      |애플         |12             |null|null |
+----------+------------+--------+-------+------+----+---------+------------+---------------+----+-----+

- execution mechanism
1. pk sharing and 1:1 relationship
2. left join characters: if a join condition is not met, append null
3. exclusive relationship between child

all product query
```sql
-- 모든 자식 테이블과 LEFT JOIN
SELECT
  p.product_id, p.product_type, p.name, p.price,
  b.author, b.isbn, b.publisher,
  e.manufacturer, e.warranty_months,
  c.size, c.color
FROM product p
LEFT JOIN book b ON p.product_id = b.product_id
LEFT JOIN electronics e ON p.product_id = e.product_id
LEFT JOIN clothing c ON p.product_id = c.product_id;
```

orders use fk
```sql
DROP TABLE IF EXISTS orders;

CREATE TABLE orders (
  order_id BIGINT PRIMARY KEY AUTO_INCREMENT,
  product_id BIGINT NOT NULL,
  quantity INT NOT NULL,
  order_date DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (product_id) REFERENCES product(product_id)
);

-- 주문 데이터 입력
INSERT INTO orders (product_id, quantity) VALUES (1, 2); -- 클린 코드 2권
INSERT INTO orders (product_id, quantity) VALUES (4, 1); -- 갤럭시 1개
INSERT INTO orders (product_id, quantity) VALUES (7, 3); -- 오버핏 맨투맨 3개

SELECT
  o.order_id,
  o.quantity,
  p.product_type,
  p.name,
  p.price,
  (o.quantity * p.price) AS total_price
FROM orders o
JOIN product p ON o.product_id = p.product_id;
```

orders and product detail query
```sql
SELECT
  o.order_id,
  p.product_type,
  p.name,
  b.author,
  b.isbn,
  e.manufacturer,
  c.size,
  c.color
FROM orders o
JOIN product p ON o.product_id = p.product_id
LEFT JOIN book b ON p.product_id = b.product_id
LEFT JOIN electronics e ON p.product_id = e.product_id
LEFT JOIN clothing c ON p.product_id = c.product_id
ORDER BY o.order_id;
```