- case1: various product attributes by category
requirement: phone, labtop, clothes, food have different attributes

schema design
```sql
DROP TABLE IF EXISTS product_catalog;

CREATE TABLE product_catalog (
  product_id BIGINT PRIMARY KEY AUTO_INCREMENT,
  name VARCHAR(200) NOT NULL,
  category VARCHAR(100) NOT NULL,
  base_price INT NOT NULL,
  attributes JSON,
  created_at DATETIME NOT NULL DEFAULT NOW()
);
```

data insert
```sql
-- 스마트폰
INSERT INTO product_catalog (name, category, base_price, attributes) VALUES
('갤럭시 S24 울트라', '스마트폰', 1650000, JSON_OBJECT(
  'screen_size', 6.8,
  'storage_options', JSON_ARRAY(256, 512, 1024),
  'colors', JSON_ARRAY('티타늄 그레이', '티타늄 블랙', '티타늄 바이올렛'),
  'ram', 12,
  '5g', true,
  'camera', JSON_OBJECT('main', 200, 'ultra_wide', 12, 'telephoto', 50),
  'battery', 5000,
  'os', 'Android 14'
));

-- 노트북
INSERT INTO product_catalog (name, category, base_price, attributes) VALUES
('맥북 프로 14 M3', '노트북', 2390000, JSON_OBJECT(
  'screen_size', 14.2,
  'storage_options', JSON_ARRAY(512, 1024, 2048),
  'colors', JSON_ARRAY('스페이스 그레이', '실버'),
  'ram_options', JSON_ARRAY(18, 36),
  'cpu', 'Apple M5 Pro',
  'gpu', 'Apple M5 Pro 14코어',
  'battery_life', 17,
  'weight', 1.55,
  'ports', JSON_ARRAY('HDMI', 'USB-C', 'MagSafe', 'SD카드')
));

-- 의류
INSERT INTO product_catalog (name, category, base_price, attributes) VALUES
('오버핏 맨투맨', '의류', 45000, JSON_OBJECT(
  'sizes', JSON_ARRAY('S', 'M', 'L', 'XL', 'XXL'),
  'colors', JSON_ARRAY('블랙', '화이트', '그레이', '네이비'),
  'material', '면 100%',
  'gender', 'unisex',
  'season', JSON_ARRAY('봄', '가을'),
  'care_instructions', JSON_ARRAY('세탁기 사용 가능', '표백제 사용 금지', '낮은 온도 다림질')
));

-- 식품
INSERT INTO product_catalog (name, category, base_price, attributes) VALUES
('유기농 아보카도', '식품', 8900, JSON_OBJECT(
  'origin', '멕시코',
  'unit', '개',
  'quantity', 3,
  'organic', true,
  'storage', '냉장 보관',
  'shelf_life_days', 7,
  'nutrition', JSON_OBJECT(
    'calories', 160,
    'fat', 15,
    'protein', 2,
    'carbs', 9,
    'fiber', 7
  ),
  'allergens', JSON_ARRAY()
));

-- 가전제품
INSERT INTO product_catalog (name, category, base_price, attributes) VALUES
('LG 스탠바이미', '가전', 1290000, JSON_OBJECT(
  'screen_size', 27,
  'resolution', '1920x1080',
  'panel_type', 'IPS',
  'touch_screen', true,
  'battery_life', 3,
  'weight', 8.5,
  'speakers', JSON_OBJECT('type', '내장', 'output', '20W'),
  'connectivity', JSON_ARRAY('Wi-Fi', 'Bluetooth', 'HDMI', 'USB'),
  'os', 'webOS'
));
```

query by category
```sql
-- 스마트폰 정보 조회
SELECT
  name,
  base_price,
  attributes->>'$.screen_size' AS screen_size,
  attributes->>'$.ram' AS ram,
  attributes->>'$.battery' AS battery,
  attributes->>'$.camera.main' AS main_camera
FROM product_catalog
WHERE category = '스마트폰';

-- 식품 영양정보 조회
SELECT
  name,
  attributes->>'$.origin' AS origin,
  attributes->>'$.nutrition.calories' AS calories,
  attributes->>'$.nutrition.protein' AS protein,
  attributes->>'$.organic' AS organic
FROM product_catalog
WHERE category = '식품';
```

case2: product options and stock management
requirement: in shopping mall, one product can have multiple options 

schema design
```sql
DROP TABLE IF EXISTS product_variant;

CREATE TABLE product_variant (
  product_id BIGINT PRIMARY KEY AUTO_INCREMENT,
  name VARCHAR(200) NOT NULL,
  base_price INT NOT NULL,
  variants JSON NOT NULL,
  created_at DATETIME NOT NULL DEFAULT NOW()
);
```

data insert
```sql
INSERT INTO product_variant (name, base_price, variants) VALUES
('나이키 에어맥스', 189000, JSON_ARRAY(
  JSON_OBJECT('sku', 'AM-BLK-250', 'color', '블랙', 'size', 250, 'stock', 15, 'price_adjust', 0),
  JSON_OBJECT('sku', 'AM-BLK-255', 'color', '블랙', 'size', 255, 'stock', 23, 'price_adjust', 0),
  JSON_OBJECT('sku', 'AM-BLK-260', 'color', '블랙', 'size', 260, 'stock', 18, 'price_adjust', 0),
  JSON_OBJECT('sku', 'AM-BLK-265', 'color', '블랙', 'size', 265, 'stock', 12, 'price_adjust', 0),
  JSON_OBJECT('sku', 'AM-WHT-250', 'color', '화이트', 'size', 250, 'stock', 8, 'price_adjust', 0),
  JSON_OBJECT('sku', 'AM-WHT-255', 'color', '화이트', 'size', 255, 'stock', 20, 'price_adjust', 0),
  JSON_OBJECT('sku', 'AM-WHT-260', 'color', '화이트', 'size', 260, 'stock', 5, 'price_adjust', 0),
  JSON_OBJECT('sku', 'AM-LTD-260', 'color', '한정판 골드', 'size', 260, 'stock', 3, 'price_adjust', 50000)
));

select * from product_variant;
```

- json_table: deal json array as table
```sql
SELECT
  p.name,
  p.base_price,
  v.sku,
  v.color,
  v.size,
  v.stock,
  (p.base_price + v.price_adjust) AS final_price
FROM product_variant p,
JSON_TABLE(p.variants, '$[*]' COLUMNS (
  sku VARCHAR(50) PATH '$.sku',
  color VARCHAR(50) PATH '$.color',
  size INT PATH '$.size',
  stock INT PATH '$.stock',
  price_adjust INT PATH '$.price_adjust'
)) AS v;
```
- p.variants: json value or json type column
- path: criteria path
  - $[*]: all elements of root array
  - $.orders[*]: orders array elements
- COLUMNS(): json -> column mapping
  - ex. size INT PATH '$.size': $.size -> size column(int type)
