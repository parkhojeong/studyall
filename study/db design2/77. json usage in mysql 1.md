setup
```sql
drop table if exists product_json;

create table product_json
(
    id         bigint primary key auto_increment,
    name       varchar(255),
    category   varchar(255),
    
    attributes json
);
```
- json type is verified to json format.

* json data insertion

- string
```sql
insert into product_json(name, category, attributes) values
('iphone', 'phone', '{"screen_size": 6.2, "color": "black"}');
```

- json_object function
```sql
insert into product_json(name, category, attributes) values
('iphone', 'phone', 
 json_object(
    'screen_size', 6.2,
    'storage': 256,
    'color': 'black'
 )
);
```

- json_array function
```sql
insert into product_json(name, category, attributes) values
('iphone', 'phone',
 json_object(
 'screen_size', 6.2,
 'storage': 256,
 'color': 'black',    
 'ports', json_array('usb-c', 'mini-jack')
 )
);
```

sample data insert
```sql
-- 샘플 데이터 입력
INSERT INTO product_json (name, category, attributes) VALUES
('갤럭시 탭 S9', '태블릿',
'{"screen_size": 11.0, "storage": 128, "color": "그라파이트", "ram": 8, "5g": false, "s_pen": true}'),

('소니 WH-1000XM5', '헤드폰',
'{"color": "블랙", "noise_canceling": true, "battery_life": 30, "driver_size": 30, "bluetooth": "5.2"}'),

('LG 그램 17', '노트북',
'{"screen_size": 17.0, "storage": 512, "color": "화이트", "ram": 16, "weight": 1.35, "ports": ["USB-C", "USB-A", "HDMI"]}'),

('에어팟 프로 2', '이어폰',
'{"color": "화이트", "noise_canceling": true, "battery_life": 6, "case_battery": 30, "spatial_audio": true}'),

('갤럭시 워치 6', '스마트워치',
'{"screen_size": 1.5, "color": "실버", "battery_life": 40, "water_resistant": true, "gps": true}');
```

* json data query

- all json query
```sql
select name, attributes from product_json;
```

- json_extract function
```sql
select 
    name, 
    json_extract(attributes, '$.screen_size') as screen_size,
    json_extract(attributes, '$.storage') as storage,
    json_extract(attributes, '$.color') as color
from product_json
where category = 'phone';
```
- caution
    - json_extract return native type
    - like color is "black"
- mysql provide json_extract for sql standard(json_query)

- -> operator
```sql
select 
    name, 
    attributes -> '$.screen_size' as screen_size,
    attributes -> '$.storage' as storage,
    attributes -> '$.color' as color
from product_json
where category = 'phone';
```

- json_value function
```sql
select 
    name,
    json_value(attributes, '$.screen_size') as screen_size,
    json_value(attributes, '$.storage') as storage,
    json_value(attributes, '$.color') as color
from product_json
where category = 'phone';
```
+------+-----------+-------+-----+
|name  |screen_size|storage|color|
+------+-----------+-------+-----+
|iphone|6.2        |256    |null |
|iphone|6.2        |256    |null |
|iphone|6.2        |null   |black|
|iphone|6.2        |null   |black|
+------+-----------+-------+-----+
- return string type by default

- json_value return type
```sql
select 
    name,
    json_value(attributes, '$.storage') as storage_text,
    json_value(attributes, '$.storage' RETURNING UNSIGNED) as storage,
    json_value(attributes, '$.screen_size' RETURNING DECIMAL(4,2)) as screen_size,
    json_value(attributes, '$.screen_size' RETURNING DECIMAL) as screen_size_decimal_default
from product_json
where category = 'phone';
```
- without RETURNING, string type is returned
- with RETURNING UNSIGNED, unsigned integer type is returned
- with RETURNING DECIMAL(4,2), decimal type is returned

* supported data type in json_value

1. numeric types

| type               | description   | example                 |
|--------------------|---------------|-------------------------|
| UNSIGNED [INTEGER] | >= 0          | RETURNING UNSIGNED      |
| SINGED [INTEGER]   | integer       | RETURNING SIGNED        |
| DECIMAL[(M[,D])]   | fixed decimal | RETURNING DECIMAL(10,2) |
| FLOAT              | float         | RETURNING FLOAT         |
| DOUBLE             | double        | RETURNING DOUBLE        |

2. date and time types

| type     | description | example            |
|----------|-------------|--------------------|
| DATE     | YYYY-MM-DD  | RETURNING DATE     |
| TIME     | HH:MM:SS    | RETURNING TIME     |
| DATETIME | DATE + TIME | RETURNING DATETIME |

3. string and binary types
by default, json_value return varchar(512)
- char is used for over 512 bytes
- binary is used for binary data

| type        | description                     | example              |
|-------------|---------------------------------|----------------------|
| CAHR[(N)]   | fixed length string             | RETURNING CHAR(50)   |
| BINARY[(N)] | binary string(casing sensitive) | RETURNING BINARY(16) |

```sql
select 
    name,
    json_value(attributes, '$.color' RETURNING CHAR(5)),
    json_value(attributes, '$.color' RETURNING BINARY(5))
from product_json
where category = 'phone';
```

- ->> operator
same as json_value without returning
removing double quotes
```sql
select
  name,
  attributes ->> '$.screen_size'
from product_json
where category = 'phone';
```

- array type function
```sql
select name,
       attributes -> '$.ports[0]'
from product_json
where category = '노트북';
```

* json condition search
- numeric comparison
```sql
select name, attributes -> '$.screen_size' 
from product_json 
where attributes -> '$.screen_size' > 5;
```

- string comparison
```sql
select name, attributes -> '$.color' 
from product_json 
where attributes ->> '$.color' like '%블랙%';
```

- json_contains function for array search
```sql
select name, attributes -> '$.ports' 
from product_json 
where json_contains(attributes -> '$.ports', '"usb-c"');
```
- caution: second argument must be string with ""

- json_contains_path function for key existence search
```sql
select name, category, attributes -> '$.s_pen' 
from product_json 
where json_contains_path(attributes, 'one', '$.s_pen');
```