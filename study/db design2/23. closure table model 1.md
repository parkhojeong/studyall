* how to handle these cases?
- category data has over 10,000 records
- depth is over 10
- very frequent hierarchy query

* closure table model
- all ancestor-descendant relationships stored in a single table
- core idea: a recursive query in read time is transferred to storage time 
- closure meaning: all relationships are closed in the table

* table design
```sql
DROP TABLE IF EXISTS category_path;
DROP TABLE IF EXISTS category_closure;

create table category_closure(
    category_id bigint primary key,
    name varchar(255)
);
create table category_path(
    ancestor_id bigint,
    descendant_id bigint,
    depth int not null,
    primary key(ancestor_id, descendant_id),
    foreign key(ancestor_id) references category_closure(category_id),
    foreign key(descendant_id) references category_closure(category_id)
);

create index idx_descendant on category_path(descendant_id);
create index idx_depth on category_path(depth);
```

- insert data
```sql
-- 카테고리 데이터
INSERT INTO category_closure (category_id, name) VALUES (1, '전자제품');
INSERT INTO category_closure (category_id, name) VALUES (2, '컴퓨터');
INSERT INTO category_closure (category_id, name) VALUES (3, '스마트폰');
INSERT INTO category_closure (category_id, name) VALUES (4, '노트북');
INSERT INTO category_closure (category_id, name) VALUES (5, '데스크탑');
INSERT INTO category_closure (category_id, name) VALUES (6, '애플');
INSERT INTO category_closure (category_id, name) VALUES (7, '삼성');

-- 경로 데이터
-- 자기 자신에 대한 경로 (depth = 0)
-- (ancestor_id, descendant_id, depth)
INSERT INTO category_path VALUES (1, 1, 0);
INSERT INTO category_path VALUES (2, 2, 0);
INSERT INTO category_path VALUES (3, 3, 0);
INSERT INTO category_path VALUES (4, 4, 0);
INSERT INTO category_path VALUES (5, 5, 0);
INSERT INTO category_path VALUES (6, 6, 0);
INSERT INTO category_path VALUES (7, 7, 0);

-- 전자제품(1)의 자식들
INSERT INTO category_path VALUES (1, 2, 1); -- 전자제품(1) -> 컴퓨터(2)
INSERT INTO category_path VALUES (1, 3, 1); -- 전자제품(1) -> 스마트폰(3)
INSERT INTO category_path VALUES (1, 4, 2); -- 전자제품(1) -> 노트북(4) (손자)
INSERT INTO category_path VALUES (1, 5, 2); -- 전자제품(1) -> 데스크탑(5) (손자)
INSERT INTO category_path VALUES (1, 6, 2); -- 전자제품(1) -> 애플(6) (손자)
INSERT INTO category_path VALUES (1, 7, 2); -- 전자제품(1) -> 삼성(7) (손자)

-- 컴퓨터(2)의 자식들
INSERT INTO category_path VALUES (2, 4, 1); -- 컴퓨터(2) -> 노트북(4)
INSERT INTO category_path VALUES (2, 5, 1); -- 컴퓨터(2) -> 데스크탑(5)

-- 스마트폰(3)의 자식들
INSERT INTO category_path VALUES (3, 6, 1); -- 스마트폰(3) -> 애플(6)
INSERT INTO category_path VALUES (3, 7, 1); -- 스마트폰(3) -> 삼성(7) 
```

- query all descendant
```sql
select * from category_path where ancestor_id = 2;
```