* what attribute exists is hard to know
- typo can occur

attribute definition table
```sql
DROP TABLE IF EXISTS product_attribute;
DROP TABLE IF EXISTS attribute_definition;

-- 속성 정의 테이블
CREATE TABLE attribute_definition (
  attr_def_id BIGINT PRIMARY KEY AUTO_INCREMENT,
  category_id BIGINT,
  
  attr_name VARCHAR(100) NOT NULL,
  attr_label VARCHAR(100) NOT NULL,
    
  attr_type VARCHAR(20) NOT NULL,  -- TEXT, NUMBER, BOOLEAN, SELECT
  is_required BOOLEAN DEFAULT FALSE,
  is_searchable BOOLEAN DEFAULT FALSE,
  display_order INT DEFAULT 0,
  options VARCHAR(500),        -- SELECT 타입일 때 선택 옵션
  created_at DATETIME NOT NULL,
  FOREIGN KEY (category_id) REFERENCES category(category_id)
);

-- 상품 속성 테이블 (개선)
CREATE TABLE product_attribute (
  attribute_id BIGINT PRIMARY KEY AUTO_INCREMENT,
  product_id BIGINT NOT NULL,
  
  attr_def_id BIGINT NOT NULL,
  attr_value VARCHAR(500),
  
  created_at DATETIME NOT NULL,
  FOREIGN KEY (product_id) REFERENCES product(product_id),
  FOREIGN KEY (attr_def_id) REFERENCES attribute_definition(attr_def_id)
);

CREATE INDEX idx_product_attribute_product ON product_attribute(product_id);
CREATE INDEX idx_product_attribute_def ON product_attribute(attr_def_id);
```
- attr_name is replaced to attr_def_id
- attribute metadata can be managed
- attribute_definition reference category
- attribute duplication is prevented by unique(product_id, attr_def_id)

insert data
```sql
-- 스마트폰 카테고리 속성 정의
INSERT INTO attribute_definition
(category_id, attr_name, attr_label, attr_type, is_required, is_searchable, display_order, options, created_at) VALUES
(2, 'screen_size', '화면 크기', 'TEXT', TRUE, TRUE, 1, NULL, NOW()),
(2, 'battery_capacity', '배터리 용량', 'TEXT', TRUE, TRUE, 2, NULL, NOW()),
(2, 'ram', 'RAM', 'SELECT', TRUE, TRUE, 3, '4GB,6GB,8GB,12GB,16GB', NOW()),
(2, 'storage', '저장 용량', 'SELECT', TRUE, TRUE, 4, '64GB,128GB,256GB,512GB,1TB', NOW()),
(2, 'processor', '프로세서', 'TEXT', TRUE, FALSE, 5, NULL, NOW()),
(2, 'main_camera', '메인 카메라', 'TEXT', FALSE, TRUE, 6, NULL, NOW()),
(2, 'color', '색상', 'TEXT', TRUE, TRUE, 7, NULL, NOW()),
(2, 'water_resistance', '방수 등급', 'SELECT', FALSE, TRUE, 8, 'IP67,IP68', NOW()),
(2, '5g_support', '5G 지원', 'BOOLEAN', FALSE, TRUE, 9, NULL, NOW());

-- 의류 카테고리 속성 정의
INSERT INTO attribute_definition
(category_id, attr_name, attr_label, attr_type, is_required, is_searchable, display_order, options, created_at) VALUES
(5, 'material', '소재', 'TEXT', TRUE, TRUE, 1, NULL, NOW()),
(5, 'size', '사이즈', 'SELECT', TRUE, TRUE, 2, 'XS,S,M,L,XL,XXL', NOW()),
(5, 'color', '색상', 'TEXT', TRUE, TRUE, 3, NULL, NOW()),
(5, 'origin', '원산지', 'TEXT', FALSE, FALSE, 4, NULL, NOW()),
(5, 'washing', '세탁 방법', 'TEXT', FALSE, FALSE, 5, NULL, NOW()),
(5, 'season', '시즌', 'SELECT', FALSE, TRUE, 6, 'S/S,F/W,사계절', NOW());
```

query to attribute definition by category
```sql
SELECT
    ad.attr_name,
    ad.attr_label,
    ad.attr_type,
    CASE WHEN ad.is_required THEN 'Y' ELSE 'N' END AS required,
    CASE WHEN ad.is_searchable THEN 'Y' ELSE 'N' END AS searchable,
    ad.options
FROM attribute_definition ad
         JOIN category c ON ad.category_id = c.category_id
WHERE c.name = '스마트폰'
ORDER BY ad.display_order;
```
+----------------+----------+---------+--------+----------+--------------------------+
|attr_name       |attr_label|attr_type|required|searchable|options                   |
+----------------+----------+---------+--------+----------+--------------------------+
|screen_size     |화면 크기     |TEXT     |Y       |Y         |null                      |
|battery_capacity|배터리 용량    |TEXT     |Y       |Y         |null                      |
|ram             |RAM       |SELECT   |Y       |Y         |4GB,6GB,8GB,12GB,16GB     |
|storage         |저장 용량     |SELECT   |Y       |Y         |64GB,128GB,256GB,512GB,1TB|
|processor       |프로세서      |TEXT     |Y       |N         |null                      |
|main_camera     |메인 카메라    |TEXT     |N       |Y         |null                      |
|color           |색상        |TEXT     |Y       |Y         |null                      |
|water_resistance|방수 등급     |SELECT   |N       |Y         |IP67,IP68                 |
|5g_support      |5G 지원     |BOOLEAN  |N       |Y         |null                      |
+----------------+----------+---------+--------+----------+--------------------------+
- notes: options can be normalized

attribute list by category
```sql
-- 스마트폰 카테고리 상품 등록 시 필요한 속성 폼 정보
SELECT
  ad.attr_def_id,
  ad.attr_name,
  ad.attr_label,
  ad.attr_type,
  ad.is_required,
  ad.options
FROM attribute_definition ad
WHERE ad.category_id = 2 -- 스마트폰
ORDER BY ad.display_order;
```
+-----------+----------------+----------+---------+-----------+--------------------------+
|attr_def_id|attr_name       |attr_label|attr_type|is_required|options                   |
+-----------+----------------+----------+---------+-----------+--------------------------+
|1          |screen_size     |화면 크기   |TEXT     |1          |null                      |
|2          |battery_capacity|배터리 용량  |TEXT     |1          |null                      |
|3          |ram             |RAM       |SELECT   |1          |4GB,6GB,8GB,12GB,16GB     |
|4          |storage         |저장 용량   |SELECT   |1          |64GB,128GB,256GB,512GB,1TB|
|5          |processor       |프로세서    |TEXT     |1          |null                      |
|6          |main_camera     |메인 카메라  |TEXT     |0          |null                      |
|7          |color           |색상       |TEXT     |1          |null                      |
|8          |water_resistance|방수 등급   |SELECT   |0          |IP67,IP68                 |
|9          |5g_support      |5G 지원    |BOOLEAN  |0          |null                      |
+-----------+----------------+----------+---------+-----------+--------------------------+

- attribute_type is used for dynamic form generation in a frontend

insert attribute value
```sql
INSERT INTO product_attribute (product_id, attr_def_id, attr_value, created_at) VALUES
(1, 1, '6.8인치', NOW()),  -- screen_size (id:1)
(1, 2, '5000mAh', NOW()),  -- battery_capacity (id:2)
(1, 3, '12GB', NOW());   -- ram (id:3)
```

check
```sql
select * from product_attribute;
```
+------------+----------+-----------+----------+-------------------+
|attribute_id|product_id|attr_def_id|attr_value|created_at         |
+------------+----------+-----------+----------+-------------------+
|1           |1         |1          |6.8인치     |2026-02-09 23:18:30|
|2           |1         |2          |5000mAh   |2026-02-09 23:18:30|
|3           |1         |3          |12GB      |2026-02-09 23:18:30|
+------------+----------+-----------+----------+-------------------+

query to data(product_id:1)
```sql
select 
    *
from product
join product_attribute on product.product_id = product_attribute.product_id
join attribute_definition on product_attribute.attr_def_id = attribute_definition.attr_def_id
where product.product_id = 1;
```

* summary
- eav pattern: attribute can be added without changing the table structure
- metadata management: attribute_definition table manage data_type, required, etc
