* why is a recursive query needed?
- in situation when depth of tree is unknown, recursive query is needed.
- since MySQL 8.0, recursive common table expression(CTE) is supported

* what is cte(common table expression)?
- cte is temporary table that has a name
```sql
with cte_name as (
    select ...    
)
select * from cte_name;
```
example
```sql
use my_shop4;
with top_categories as (
    select * from category where parent_id is null
)
select * from top_categories;
```
pros
- readability is improved
- the same cte is used for multiple queries
- recursive query can be written

* recursive cte grammar
```sql
with recursive cte_name as (
    select ... -- anchor member
    
    union all
    
    select ... from cte_name where ... -- recursive member 
)
select * from cte_name;
```
- anchor member: start point of recursion. first query 
- recursive member: repeatably executed query

execution flow
1. anchor member is executed
2. recursive member is executed
3. repeat until the recursive member returns no more rows
4. return all rows combined from all executions

example: query all descendants of category_id=1 using recursive cte 
```sql
with recursive temp_category as (
    select category_id, name, parent_id, 1 as depth 
    from category 
    where category_id=1
    
    union all
    
    select c.category_id, c.name, c.parent_id, d.depth+1
    from category c
    join temp_category d on c.parent_id=d.category_id
)
select * from temp_category;
```
execution flow
step1. 
- the anchor member is executed and assigned to the temp_category table
step2. 
- a recursive member is executed using temp_category
- and the result is assigned to the temp_category table(not appended, but replaced)
- if temp_category is empty, break the loop
step3.
- all steps temp_category is assigned to temp_category table

real execution flow
1. rows where category_id=1 are assigned to temp_category table -> category_id=1
2. rows where parent_id=1 are assigned to temp_category table -> category_id=4,5,6
3. rows where parent_id in (4,5,6) are assigned to temp_category table -> category_id=7,8,9,10,11,12,13
4. rows where parent_id in (7,8,9,10,11,12,13) are empty -> break the loop
5. 1,2,3 tables are assigned to temp_category table