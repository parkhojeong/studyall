* why separate table?
suppose data query pattern 
- current data query: 99% - normally
- history data query: 1% - when a problem occurs, audit log is needed, analysis is needed

table design
split into product, product_history
```sql
use my_shop4;
DROP TABLE IF EXISTS product;

CREATE TABLE product (
    product_id BIGINT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(200) NOT NULL,
    price INT NOT NULL,
    stock_quantity INT NOT NULL DEFAULT 0,
    status VARCHAR(20) NOT NULL DEFAULT 'ACTIVE',
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    created_by VARCHAR(100) NOT NULL,
    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    updated_by VARCHAR(100) NOT NULL
);

DROP TABLE IF EXISTS product_history;

CREATE TABLE product_history (
    history_id BIGINT PRIMARY KEY AUTO_INCREMENT,
    product_id BIGINT NOT NULL,
    name VARCHAR(200) NOT NULL,
    price INT NOT NULL,
    stock_quantity INT NOT NULL DEFAULT 0,
    status VARCHAR(20) NOT NULL DEFAULT 'ACTIVE',
    created_at DATETIME NOT NULL,
    created_by VARCHAR(100) NOT NULL,
    
    history_created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    history_created_by VARCHAR(100) NOT NULL,
    change_type VARCHAR(50),
    change_reason VARCHAR(500),
    
    INDEX idx_product_id (product_id),
    INDEX idx_history_created_at (history_created_at)
);
```

* product_history two types of time
- created_at: product created time
- history_created_at: product history created time

| division         | created_at                     | history_created_at                                          |
|------------------|--------------------------------|-------------------------------------------------------------|
| meaning          | product creation time          | history creation time                                       |
| question example | when is product is registered? | when product price is changed, what is value at specific time |
| value change     | not changed in same product_id | when update occurs, every time is saved                     |
| notes            | data's attribute               | data update's timeline                                      |


first data insert
```sql
-- 현재 테이블에 등록
INSERT INTO product (name, price, stock_quantity, status, created_by, updated_by, created_at) 
VALUES ('스마트폰 케이스', 15000, 100, 'ACTIVE', 'admin_kim', 'admin_kim', '2026-01-15 10:00:00');

-- 이력 테이블에도 등록 (첫 데이터)
INSERT INTO product_history (product_id, name, price, stock_quantity, status, created_at, created_by, history_created_at, history_created_by, change_type, change_reason)
SELECT product_id, name, price, stock_quantity, status, created_at, created_by, '2026-01-15 10:00:00', 'admin_kim', 'CREATE', '신규 상품 등록'
FROM product WHERE product_id = LAST_INSERT_ID();
```
- created_at is directly assigned for exercise

second data insert
```sql
INSERT INTO product (name, price, stock_quantity, status, created_by, updated_by, created_at)
VALUES ('무선 이어폰', 89000, 50, 'ACTIVE', 'admin_lee', 'admin_lee', '2026-01-15 10:05:00');

INSERT INTO product_history (product_id, name, price, stock_quantity, status, created_at, created_by, history_created_at, history_created_by, change_type, change_reason)
SELECT product_id, name, price, stock_quantity, status, created_at, created_by, '2026-01-15 10:05:00', 'admin_lee', 'CREATE', '신규 상품 등록'
FROM product WHERE product_id = LAST_INSERT_ID();
```

check table
```sql
SELECT product_id, name, price, stock_quantity, created_at
FROM product;

SELECT history_id, product_id, name, price, change_type, history_created_at
FROM product_history;
```
| product_id | name        | price | stock_quantity | created_at          |
|:-----------|:------------|:------|:---------------|:--------------------|
| 1          | 스마트폰 케이스 | 15000 | 100            | 2026-01-15 10:00:00 |
| 2          | 무선 이어폰    | 89000 | 50             | 2026-01-15 10:05:00 |

| history_id | product_id | name        | price | change_type | history_created\_at |
|:-----------|:-----------|:------------|:------|:------------|:--------------------|
| 1          | 1          | 스마트폰 케이스 | 15000 | CREATE      | 2026-01-15 10:00:00 |
| 2          | 2          | 무선 이어폰    | 89000 | CREATE      | 2026-01-15 10:05:00 |


data update
```sql
INSERT INTO product_history (product_id, name, price, stock_quantity, status, created_at, created_by, history_created_at, history_created_by, change_type, change_reason)
VALUES (1, '스마트폰 케이스', 12000, 100, 'ACTIVE', '2026-01-15 10:00:00', 'admin_kim', '2026-03-01 10:00:00', 'admin_park', 'PRICE_CHANGE', '봄맞이 할인 이벤트');

UPDATE product
SET price = 12000,
  updated_at = '2026-03-01 10:00:00',
  updated_by = 'admin_park'
WHERE product_id = 1;
```
- updated_at, hitstory_created_at is assigned for exercise


* pros
1. current data and history data are separated
2. table management is easier
- history table can be applied to partitioning, archiving, etc.