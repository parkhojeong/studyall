* function-based index
- since MySQL 8.0.13, a function(expression) result can be indexed

1. function-based index creation
```sql
drop index idx_v_storage on product_json;
drop index idx_func_storage on product_json;

create index idx_func_storage
on product_json ((cast(attributes->"$.storage" as unsigned)))
```
or json_value can be used
```sql
create index idx_func_storage
on product_json ((json_value(attributes, '$.storage' returning unsigned)))
```
- ((...)): when expression is indexed, use double parentheses
- type must be defined for index
- internally, MySQL uses a virtual column and creates an index on it. function-based index is syntactic sugar

2. execution plan
```sql
explain select * from product_json where attributes->'$.storage' = 256
```
+--+-----------+------------+----------+----+----------------+----------------+-------+-----+----+--------+-----+
|id|select_type|table       |partitions|type|possible_keys   |key             |key_len|ref  |rows|filtered|Extra|
+--+-----------+------------+----------+----+----------------+----------------+-------+-----+----+--------+-----+
|1 |SIMPLE     |product_json|null      |ref |idx_func_storage|idx_func_storage|9      |const|1   |100     |null |
+--+-----------+------------+----------+----+----------------+----------------+-------+-----+----+--------+-----+
- if a virtual column is used in a select query, use virtual column approach
- only when it is used in where clause, use function-based index approach

* multi-valued index
- for array type index
- since MySQL 8.0.17 support

1. multi-valued index creation
```sql
drop index idx_ports on product_json;
CREATE INDEX idx_ports
    ON product_json (( CAST(attributes->'$.ports' AS CHAR(20) ARRAY) ));
```
- cast(... as ... array): json array values are transformed into a string(char(20)) and indexed 
- caution: double parentheses are required

2. multi-valued index usage
for index, this functions are required
- member of()
- json_contains()
- json_overlaps()

3. execution plan
```sql
EXPLAIN
SELECT id, name, attributes->>'$.ports'
FROM product_json
WHERE 'HDMI' MEMBER OF(attributes->'$.ports');
```

* json index summary
json index
- generated column + index
- function-based index without virtual column(MySQL 8.0.13+)
- multi-valued index for json array search optimazation(MySQL 8.0.17+)
performance optimization strategy
- a frequently used column is indexed
- use hybrid design
- keep json size small
- use partial update instead of full replace 